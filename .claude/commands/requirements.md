---
description: 要件定義フェーズ - EARS記法による要件記述、対話式詳細化、specs/requirements.md生成・更新
allowed-tools: Read, Write, Edit, mcp__context7__*, mcp__firecrawl__*, WebSearch, TodoWrite, Bash
---

**設計ドリブン開発ワークフロー - フェーズ1: 要件定義**

あなたは要件定義の専門家として、以下のプロセスで要件定義書を作成します：

## 実行手順

### 1. 初期設定・状況確認
```
1. action: "check_existing_requirements"
   - specs/requirements.mdの存在確認
   - 既存要件がある場合は内容確認・更新モード
   - 新規作成の場合は初期作成モード

2. action: "setup_project_context"  
   - プロジェクトIDの生成（PROJ-YYYYMMDD-HHMM）
   - タイムスタンプの生成
   - 作業ディレクトリの確認
```

### 2. ユーザーとの対話的要件収集
以下の項目について順次質問し、要件を明確化：

**基本情報**:
- プロジェクトの目的・背景
- ターゲットユーザー
- 解決したい課題

**機能要件**:
- 必要な機能（優先度付き）
- 各機能の詳細（入力・処理・出力）
- 業務フロー・ユースケース

**非機能要件**:
- パフォーマンス要件（レスポンス時間、スループット）
- セキュリティ要件
- 可用性・拡張性要件
- 運用・保守要件

**制約条件**:
- 技術的制約（使用技術、既存システム連携）
- ビジネス制約（予算、期間、リソース）
- 環境制約（インフラ、セキュリティ）

### 3. EARS記法による要件記述
各要件をEARS記法で構造化：

**機能要件例**:
- **Event**: ユーザーが商品をカートに追加する時
- **Action**: システムは在庫を確認し
- **Response**: 在庫が十分な場合はカートに追加し確認メッセージを表示する

**非機能要件例**:
- **Condition**: 100件の商品を同時検索した場合
- **System**: システムは
- **Action**: 検索処理を実行し
- **Response**: 3秒以内に結果を表示する

### 4. ドキュメント生成・更新
```
1. action: "generate_requirements_document"
   - テンプレート適用（.claude/templates/requirements-template.md使用）
   - 一意IDの付与（REQ-F001, REQ-NF001形式）
   - 変数置換（${PROJECT_ID}, ${DATE}など）

2. action: "save_document"
   - path: "specs/requirements.md"
   - backup: 既存ファイルがある場合は.bakファイル作成
   - validation: 必須項目の存在確認
```

### 5. 品質確認・検証
```
1. action: "validate_requirements"
   - EARS記法の適用確認
   - 要件の曖昧さチェック
   - 測定可能性の確認

2. action: "cross_reference_check"
   - 要件間の整合性確認
   - 重複要件の検出
   - 漏れ要件の確認
```

### 6. フェーズ完了処理
```
1. action: "phase_completion_check"
   - 全必須項目の記入確認
   - ユーザーの完了合意確認
   
2. action: "next_phase_guidance"
   - 次フェーズの案内メッセージ表示
   - `/design`コマンド実行の推奨
```

## 対話ガイドライン

### 質問の進め方
1. **オープンクエスチョン**: まず広く情報を収集
2. **クローズドクエスチョン**: 具体的な仕様を確定
3. **確認質問**: 理解の相違がないか確認
4. **優先度確認**: 重要度・緊急度の明確化

### 要件品質の確保
- **具体性**: 曖昧な表現を避け、具体的な数値・条件で記述
- **検証可能性**: テスト可能な形で記述
- **一貫性**: 他の要件との矛盾がないか確認
- **追跡可能性**: 一意IDによる管理

### エラーハンドリング
- 不明確な回答：追加質問で明確化
- 矛盾する要求：整理して優先順位確認
- 範囲外要求：スコープの再確認

## フェーズ終了条件
以下の条件を満たした時点でフェーズ完了：
- [ ] 全機能要件がEARS記法で記述されている
- [ ] 全非機能要件が定量的に記述されている  
- [ ] 制約条件が明確に定義されている
- [ ] 受入条件が具体的に設定されている
- [ ] ユーザーが内容に合意している

**フェーズ完了時のメッセージ**:
```
🎯 要件定義フェーズが完了しました！

📋 生成されたファイル:
- specs/requirements.md (要件定義書)

🔄 次のステップ:
詳細設計フェーズに進むには以下のコマンドを実行してください：
`/design`

📝 要件の修正が必要な場合は、再度 `/requirements` コマンドを実行してください。
```

---

ユーザーの要求: $ARGUMENTS

まず既存のrequirements.mdの確認から開始し、対話的に要件定義を進めてください。