---
description: 修正問題の分析→情報収集→修正プラン作成（Planモード）→承認後実行の2段階プロセス
allowed-tools: mcp__context7__*, mcp__firecrawl__*, WebSearch, TodoWrite, ExitPlanMode
---

ultrathink

**修正プロセス（2段階）**：
1. **Planモード**: 情報収集→分析→修正プラン作成→提示
2. **実行モード**: ユーザー承認後に実際の修正作業実施

## Phase 1: 情報収集・分析・プラン作成

### 1. Context7（第一優先）
まず関連するライブラリ/フレームワークのドキュメントをContext7で検索：
- エラーメッセージが含まれている場合：
  - `mcp__context7__resolve-library-id` で関連ライブラリを特定
  - `mcp__context7__get-library-docs` でエラーコード、トラブルシューティング情報を取得
- ライブラリ機能実装の場合：
  - 最新APIドキュメント
  - ベストプラクティス
  - バージョン固有の変更点を取得

### 2. Firecrawl（フォールバック）
Context7で十分な情報が得られない場合：
- 公式ドキュメントサイトをスクレイピング
- GitHubリポジトリ（公式のみ）の最新情報を取得
- `mcp__firecrawl__firecrawl_search`または`mcp__firecrawl__firecrawl_scrape`を使用

### 3. Web検索（最終フォールバック）
Firecrawlでも情報不足の場合：
- Stack Overflow（検証済み回答のみ）
- 公式ドキュメントの補完検索
- 複数ソースでクロスリファレンス

### 4. 修正プラン作成・提示
情報収集完了後、`ExitPlanMode`ツールで以下を含む修正プランを提示：
- 問題の根本原因分析
- 具体的な修正手順（ステップbyステップ）
- 修正対象ファイル・コード箇所
- 想定される影響範囲
- テスト・検証方法
- リスク要因と対策

## Phase 2: 実行モード（承認後）

ユーザーがプランを承認後：
1. プランに従って段階的修正実行
2. 各ステップ後の動作確認
3. 異常時の即座復旧対応
4. 最終確認・テスト実行

## 注意事項

- **必ずPlanモードから開始**: 情報収集→プラン提示→承認待ち
- 段階的情報収集：各段階の結果を評価してから次に進む
- Context7を最優先：特にエラー処理時の正確な情報取得
- 情報不足時は明記してから次の手段を試行
- プラン提示は日本語で具体的かつ分かりやすく

---

問題の詳細: $ARGUMENTS

まず情報収集を開始し、分析後にExitPlanModeで修正プランを提示してください。